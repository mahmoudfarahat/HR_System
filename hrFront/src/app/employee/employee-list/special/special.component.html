<button (click)="addNew()">Add</button>

<ng-container *ngFor="let row of rows; let j = index; trackBy: trackByIndex">
  <div class="parent">
    {{ row.index }}
    <button (click)="addChildNew(row)">Add</button>
    <button (click)="addInput(row)">Add inside Or</button>
    <button (click)="addInput(row)">Add inside And</button>

    <div *ngFor="let insiderow of row.insiderows; let i = index; trackBy: trackByIndex">
      <input type="text" [(ngModel)]="insiderow.search" />
    </div>

    <!-- Generate and display combined search query for parent row -->
    <div>{{ row.generateQuery() }}</div>

    <ng-container *ngTemplateOutlet="recursiveRow; context:{ rows: row.row, parentIndex: j + '-'}">
    </ng-container>
  </div>
</ng-container>

<ng-template #recursiveRow let-rows="rows" let-parentIndex="parentIndex">
  <ng-container *ngFor="let childRow of rows; let o = index; trackBy: trackByIndex">
    <div class="child">
      {{ childRow.index }}
      <button (click)="addChildNew(childRow)">Add</button>
      <button (click)="addNestedInput(childRow)">Add inside Or</button>
      <button (click)="addNestedInput(childRow)">Add inside And</button>



      <div *ngFor="let insiderow of childRow.insiderows; let y = index; trackBy: trackByIndex">
        <input type="text" [(ngModel)]="insiderow.search" />
      </div>

      <!-- Generate and display combined search query for child row -->
      <div>{{ childRow.generateQuery() }}</div>

      <ng-container *ngTemplateOutlet="recursiveRow; context:{ rows: childRow.row, parentIndex: parentIndex + o + '-'}">
      </ng-container>
    </div>
  </ng-container>
</ng-template>


<pre>{{ rows |json}}</pre>
